!function(C,t){"use strict";function M(e){return e<0?-1:1}function I(e,t,n,i,o){return(e-t)*(o-i)/(n-t)+i}var o="onwheel"in document?"wheel":"mousewheel";C.widget("vanderlee.coverflow",{options:{animateComplete:t,animateStart:t,animateStep:t,density:1,duration:"normal",easing:t,enableKeyboard:"both",enableClick:!0,enableWheel:!0,index:0,innerAngle:-75,innerCss:t,innerOffset:100/3,innerScale:.75,outerAngle:-30,outerCss:t,outerScale:.25,selectedCss:t,visible:"density",width:t,change:t,confirm:t,select:t},_window_handler_resize:null,_window_handler_keydown:null,_create:function(){var e,r=this,t=r._getCovers(),n=t.filter("img").add("img",t).filter(function(){return!(this.complete||0<this.height)}),i=Math.max.apply(null,t.map(function(){return C(this).height()}).get());return r.widgetEventPrefix="vanderlee-coverflow",r.hovering=!1,r.pagesize=1,r.currentIndex=r.options.index,r.element.height(i),n.on(function(){e=r._getCovers().height(),i<e&&(i=e,r.element.height(i))}),t.hide(),this.element.not(":tabbable")&&(this.element.attr("tabIndex",-1),this.element.attr("autofocus")&&this.element.focus()),r.element.on("mousedown tap click","> *",function(e){var t;r.options.enableClick&&((t=r._getCovers().index(this))===r.currentIndex?r._callback("confirm",e):r._setIndex(t,!0))}),r.element.on(o,function(e){var t,n;r.options.enableWheel&&(t=0<("deltaY"in(n=e).originalEvent?0-n.originalEvent.deltaY:"wheelDelta"in n.originalEvent?n.originalEvent.wheelDelta:void 0)?1:-1,e.preventDefault(),r._setIndex(r.options.index-t,!0))}),C.isFunction(r.element.swipe)&&r.element.swipe({allowPageScroll:"vertical",swipe:function(e,t,n,i,o){var s=Math.round(1.25*("left"===t?1:"right"===t?-1:0)*r.pagesize*n/r.element.width());r._setIndex(r.options.index+s,!0)}}),r._window_handler_resize=function(){r.refresh()},C(window).on("resize",r._window_handler_resize),r._window_handler_keydown=function(e){if(0<=C.inArray(r.options.enableKeyboard,[!0,"both","focus"])&&r.element.is(":focus")||0<=(0<=C.inArray(r.options.enableKeyboard,[!0,"both","hover"]))&&r.element.is(":hover"))switch(e.which){case 36:e.preventDefault(),r._setIndex(0,!0);break;case 35:e.preventDefault(),r._setIndex(r._getCovers().length-1,!0);break;case 38:case 37:e.preventDefault(),r._setIndex(r.options.index-1,!0);break;case 40:case 39:e.preventDefault(),r._setIndex(r.options.index+1,!0);break;case 33:e.preventDefault(),r._setIndex(r.options.index-r.pagesize,!0);break;case 34:e.preventDefault(),r._setIndex(r.options.index+r.pagesize,!0)}},C(window).on("keydown",r._window_handler_keydown),r._setIndex(r.options.index,!1,!0),r},_destroy:function(){C(window).off("resize",this._window_handler_resize),C(window).off("keydown",this._window_handler_keydown),this.element.height("")},cover:function(){return C(this._getCovers()[this.options.index])},_getCovers:function(){return C("> *",this.element)},_setIndex:function(e,t,n){var i,o=this,s=o._getCovers();(e=Math.max(0,Math.min(e,s.length-1)))!==o.options.index?(s.css("position","absolute"),this._frame(o.options.index),!0===t||0===o.options.duration?(o.options.index=Math.round(e),i="number"==typeof o.options.duration?o.options.duration:jQuery.fx.speeds[o.options.duration]||jQuery.fx.speeds._default,this.refresh(i,o.options.index)):(o.options.index=Math.round(e),o.refresh(0))):!0===n&&(o.refresh(),o._callback("select"))},_callback:function(e,t){this._trigger(e,t,[this._getCovers().get(this.currentIndex),this.currentIndex])},index:function(e){if(e===t)return this.options.index;for(;e<0;)e+=this._getCovers().length;this._setIndex(e,!0)},_frame:function(_){_=_.toFixed(6);var g=this,e=g._getCovers(),m=e.length,x=g.element.innerWidth(),t=g.options.width||e.eq(this.options.index).show().get(0).offsetWidth,w="density"===g.options.visible?Math.round(x*g.options.density/t):C.isNumeric(g.options.visible)?g.options.visible:m,b=g.element.position().left-(1-g.options.outerScale)*t*.5,v=.5*(x-g.options.outerScale*t);g.pagesize=w,e.removeClass("current").each(function(e,t){var n,i=C(t),o=e-_,s=Math.min(Math.max(-1,o/w),1),r=0==o,a=m-Math.abs(Math.round(o)),l=Math.abs(o)<=w,d=Math.sin(s*Math.PI*.5),h=Math.cos(s*Math.PI*.5),c=M(d)*I(Math.abs(d),0,1,g.options.innerOffset*g.options.density,v),u=l?I(Math.abs(h),1,0,g.options.innerScale,g.options.outerScale):0,p=M(d)*I(Math.abs(d),0,1,g.options.innerAngle,g.options.outerAngle),f=r?g.options.selectedCss||{}:C.interpolate&&g.options.outerCss&&!C.isEmptyObject(g.options.outerCss)?l?C.interpolate(g.options.innerCss||{},g.options.outerCss,Math.abs(d)):g.options.outerCss:{};Math.abs(o)<1&&(p=0-(0-p)*Math.abs(o),u=1-(1-u)*Math.abs(o),c=0-(0-c)*Math.abs(o)),n="scale("+u+","+u+") perspective("+.5*x+"px) rotateY("+p+"deg)",i[r?"addClass":"removeClass"]("current"),i[l?"show":"hide"](),i.css(C.extend(f,{left:b+v+c,"z-index":a,"-webkit-transform":n,"-ms-transform":n,transform:n})),g._trigger("animateStep",null,[t,s,l,r,d,h]),_==g.options.index&&g._trigger("animateComplete",null,[t,s,l,r,d,h])})},refresh:function(e,t){var n=this,i=n.currentIndex,o=n._getCovers(),s=o.length,r=!1;n._callback("before"),o.css("position","absolute"),n.element.stop().animate({__coverflow_frame:t||n.options.index},{easing:n.options.easing,duration:e||0,step:function(e,t){n._frame(e),n.currentIndex=Math.max(0,Math.min(Math.round(e),s-1)),i!==n.currentIndex&&(i=n.currentIndex,n._callback("change"),n.currentIndex===n.options.index&&(r=!0))},complete:function(){n.currentIndex=n.options.index,n._callback("after"),r||n._callback("change"),n._callback("select")}})}})}(jQuery);
